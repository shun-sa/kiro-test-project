# プッシュ通知機能ガイド

## 概要

FinTech News Appのプッシュ通知機能は、ユーザーが重要なニュースを見逃さないように設計されています。

## 機能一覧

### 1. 通知設定

#### 通知の有効/無効
- トグルスイッチで簡単にON/OFF切り替え
- 初回有効化時にブラウザの通知許可を要求

#### 通知頻度
- **即座**: 新着記事ごとに即座に通知
- **1時間毎**: 1時間分の新着記事をまとめて通知
- **1日1回**: 朝9時に前日分の記事をまとめて通知

#### カテゴリフィルター
以下のカテゴリから通知を受け取りたいものを選択：
- 💰 FinTech
- 🤖 AI・機械学習
- ⛓️ ブロックチェーン
- ☁️ クラウド
- 🔒 セキュリティ
- 🚀 スタートアップ

#### 静寂時間
- 指定した時間帯は通知を送信しない
- デフォルト: 22:00 〜 08:00
- 日をまたぐ設定にも対応
- 緊急ニュースは静寂時間でも通知

### 2. 通知ロジック

#### 重要度判定
記事の重要度を自動的に判定：

**高重要度（緊急）**
- 速報、緊急、重大、規制、法案
- セキュリティ、脆弱性、障害
- 静寂時間でも通知

**中重要度**
- 新機能、リリース、買収、提携
- 資金調達、IPO、決算
- AI、ブロックチェーン

**低重要度**
- その他の記事

#### 通知条件
以下の条件を全て満たす記事を通知：
1. 通知が有効になっている
2. カテゴリフィルターに一致（設定されている場合）
3. 緊急ニュースまたは静寂時間外

### 3. 通知メッセージ

#### 単一記事
```
タイトル: FinTech News
本文: [緊急マーク] 記事タイトル
```

#### 複数記事（バッチ通知）
```
タイトル: FinTech News
本文: 🔴 緊急ニュース2件を含む10件の新着記事があります
```

または

```
タイトル: FinTech News
本文: 本日の新着記事が15件あります
```

### 4. 通知テスト機能

設定画面から「テスト通知を送信」ボタンで動作確認が可能：
- 現在の設定で通知がどのように表示されるかプレビュー
- 静寂時間中の場合は警告メッセージを表示
- ブラウザ通知とアプリ内プレビューの両方を表示

## 技術仕様

### 使用技術
- **Web Notifications API**: ブラウザ通知
- **Zustand**: 通知設定の状態管理
- **LocalStorage**: 設定の永続化

### ファイル構成
```
src/
├── store/
│   └── useNotificationStore.ts      # 通知設定ストア
├── lib/
│   └── notificationLogic.ts         # 通知ロジック
├── hooks/
│   └── useNotifications.ts          # 通知管理フック
└── components/
    └── features/
        └── NotificationSettings.tsx # 通知設定UI
```

### 主要関数

#### `calculateArticleImportance(article: Article)`
記事の重要度を判定（high/medium/low）

#### `shouldNotifyArticle(article, settings, isInQuietHours)`
記事を通知すべきかを判定

#### `generateNotificationMessage(articles, frequency)`
通知メッセージを生成

#### `sendBrowserNotification(title, body, article?)`
ブラウザ通知を送信

## 今後の拡張予定

### Phase 7: AWS統合
- **Web Push API**: VAPID鍵を使用した本格的なプッシュ通知
- **Lambda関数**: 新記事投稿時の自動通知配信
- **DynamoDB**: Push Subscription管理
- **EventBridge**: バッチ通知のスケジューリング

### 追加機能案
- 通知履歴の表示
- 通知音のカスタマイズ
- 通知のグルーピング
- リッチ通知（画像付き）
- アクションボタン（既読、ブックマーク）

## トラブルシューティング

### 通知が表示されない
1. ブラウザの通知許可を確認
2. 通知設定が有効になっているか確認
3. カテゴリフィルターが適切に設定されているか確認
4. 静寂時間中でないか確認

### 通知許可が取得できない
- ブラウザの設定で通知がブロックされている可能性
- ブラウザの設定から手動で許可を与える必要がある

### 通知が多すぎる
- 通知頻度を「1時間毎」または「1日1回」に変更
- カテゴリフィルターで興味のあるカテゴリのみ選択
- 静寂時間を設定

## ブラウザ対応

- Chrome/Edge: 完全対応
- Firefox: 完全対応
- Safari: 部分対応（macOS/iOS 16+）
- Opera: 完全対応

## セキュリティ

- 通知設定はローカルストレージに保存
- Push Subscriptionは永続化しない（セキュリティ上の理由）
- 通知内容に個人情報は含まれない
